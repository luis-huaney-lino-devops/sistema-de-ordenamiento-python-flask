var sort_game={canvas:null,sel:"",bt1:"",bt2:"",bt3:"",timer:null,data:[],pos:[],drag:-1,nb_move:0,nb_comp:0,balsens:"=",sol:false,mode_auto:false,nb:10,en_cours:false,wait:0,init:function(f,e,d,b,a){this.canvas=document.getElementById(f);this.sel=e;this.bt1=d;this.bt2=b;this.bt3=a;this.canvas.code=this;this.melange();$("#"+f).mousemove(this.mousemove.bind(this));$("#"+f).mousedown(this.mousedown.bind(this));$("#"+f).mouseup(this.mouseup.bind(this));$("#"+f).mouseleave(this.mouseleave.bind(this));this.timer=window.setInterval("sort_game.draw()",25);this.draw()},melange:function(d){var c=0,a=0,b=0;if(!d){if(this.sel>""){d=document.getElementsByName(this.sel)[0].value}else{d=10}if(!d){d="10"}}this.nb=parseInt(d);for(c=0;c<10;c++){this.data[c]={valeur:0};this.data[c].valeur=Math.floor((Math.random()*90)+1);this.data[c].position=c;this.data[c].index=c;this.data[c].x=20+(c*45);this.data[c].y=200;this.data[c].destx=this.data[c].x;this.data[c].desty=this.data[c].y;this.data[c].sel=false;if(c<this.nb){this.pos[c]=c;this.data[c].visible=true}else{this.pos[c]=-1;this.data[c].index=-1;this.data[c].visible=false}}for(c=0;c<this.nb;c++){a=Math.floor(Math.random()*this.nb);if(a!=c){b=this.data[c].position;this.data[c].position=this.data[a].position;this.data[a].position=b;this.data[c].index=this.data[c].position;this.data[a].index=this.data[a].position;this.pos[c]=a;this.calcdest(a);this.data[a].y=this.data[a].y-20-Math.random()*20;this.data[a].x=this.data[a].x-10+Math.random()*20}this.calcdest(c);this.data[c].y=this.data[c].y-20-Math.random()*20;this.data[c].x=this.data[c].x-10+Math.random()*20}this.nb_move=0;this.nb_comp=0;this.sol=false;for(c=10;c<22;c++){this.pos[c]=-1}this.nb_comp=0;this.nb_move=0;this.balance();this.draw()},setnewpos:function(b){var c=1,d=1;if((this.data[b].position==10)||(this.data[b].position==11)){c=10;if(this.data[b].y==this.data[b].desty){d=10}}else{d=10}if(this.data[b].x!=this.data[b].destx){if(Math.abs(this.data[b].x-this.data[b].destx)<d){this.data[b].x=this.data[b].destx}else{if(this.data[b].x<this.data[b].destx){this.data[b].x+=d}else{this.data[b].x-=d}}}else{c=10}if(this.data[b].y!=this.data[b].desty){if(Math.abs(this.data[b].y-this.data[b].desty)<c){this.data[b].y=this.data[b].desty}else{if(this.data[b].y<this.data[b].desty){this.data[b].y+=c}else{this.data[b].y-=c}}}if((this.data[b].position==10)||(this.data[b].position==11)){if((this.data[b].y==this.data[b].desty)&&(this.data[b].x==this.data[b].destx)){this.balance();this.wait=4}}},draw_plateau:function(a,c,b){b.save();b.fillStyle="#f0d77b";b.strokeStyle="#000000";b.lineJoin="round";b.lineCap="round";b.lineWidth=1;b.beginPath();b.moveTo(a,c);b.lineTo(a+70,c);b.lineTo(a+70,c+4);b.lineTo(a,c+4);b.closePath();b.fill();b.stroke();b.beginPath();b.moveTo(a,c+4);b.lineTo(a+7,c+10);b.lineTo(a+63,c+10);b.lineTo(a+70,c+4);b.closePath();b.fill();b.stroke();b.beginPath();b.moveTo(a+25,c+10);b.lineTo(a+25,c+20);b.lineTo(a+45,c+20);b.lineTo(a+45,c+10);b.closePath();b.fill();b.stroke();b.fillStyle="#737373";b.fillRect(a+30,c+20,10,120-c);b.restore()},draw_barril:function(d,b){if(!this.data[d].visible){return}var a=this.data[d].x,c=this.data[d].y;b.save();b.lineWidth=1;b.lineJoin="round";b.lineCap="round";if(this.data[d].sel){b.strokeStyle="#FF0000"}else{b.strokeStyle="#000000"}b.fillStyle="#eac7a1",b.beginPath();b.moveTo(a+5,c);b.lineTo(a+35,c);b.bezierCurveTo(a+40,c,a+40,c+65,a+35,c+65);b.lineTo(a+5,c+65);b.bezierCurveTo(a,c+65,a,c,a+5,c);b.fill();b.stroke();b.beginPath();b.moveTo(a+10,c);b.bezierCurveTo(a+5,c,a+5,c+65,a+10,c+65);b.stroke();b.beginPath();b.moveTo(a+30,c);b.bezierCurveTo(a+35,c,a+35,c+65,a+30,c+65);b.stroke();b.beginPath();b.moveTo(a+20,c);b.lineTo(a+20,c+65);b.stroke();b.fillStyle="#9a9c9f";b.beginPath();b.moveTo(a+1,c+10);b.lineTo(a+39,c+10);b.lineTo(a+40,c+15);b.lineTo(a,c+15);b.closePath();b.fill();b.stroke();b.beginPath();b.moveTo(a,c+27);b.lineTo(a+40,c+27);b.lineTo(a+40,c+32);b.lineTo(a,c+32);b.closePath();b.fill();b.stroke();b.beginPath();b.moveTo(a,c+45);b.lineTo(a+40,c+45);b.lineTo(a+39,c+50);b.lineTo(a+1,c+50);b.closePath();b.fill();b.stroke();if(this.sol){b.fillStyle="#000000";b.fillRect(a+10,c+20,20,20);b.fillStyle="#ffffff";b.fillText(this.data[d].valeur,a+20,c+35)}b.restore()},draw:function(){if(this.auto){if(this.en_cours){return}this.en_cours=true}if(this.wait>0){this.wait--;return}var e=0,d=0,c=this.canvas.getContext("2d");var b=this.canvas.width,f=this.canvas.height,a=0,k=0;if(this.sol){c.font="bold 16px Courier";c.textAlign="center"}c.clearRect(0,0,b,f);var g=c.createLinearGradient(0,0,0,300);g.addColorStop(1,"#102187");g.addColorStop(0,"white");c.fillStyle=g;c.fillRect(0,0,b,f);switch(this.balsens){case"<":e=110;d=90;break;case">":e=90;d=110;break;default:e=100;d=100}this.draw_plateau(310,e,c);this.draw_plateau(400,d,c);c.fillStyle="#737373";c.save();c.translate(390,140);switch(this.balsens){case"<":c.rotate(-0.1);break;case">":c.rotate(0.1);break;default:}c.beginPath();c.moveTo(-50,-10);c.lineTo(50,-10);c.lineTo(50,-2);c.lineTo(40,-2);c.bezierCurveTo(40,-10,-40,-10,-40,-2);c.lineTo(-50,-2);c.closePath();c.fill();c.restore();c.fillStyle="#b47925";c.fillRect(305,140,170,5);c.fillRect(300,145,180,15);c.beginPath();c.moveTo(300,160);c.lineTo(480,160);c.lineTo(480,180);c.lineTo(470,180);c.bezierCurveTo(470,160,310,160,310,180);c.lineTo(300,180);c.closePath();c.fill();c.beginPath();c.moveTo(380,140);c.lineTo(380,120);c.arc(390,120,10,1*Math.PI,0*Math.PI);c.lineTo(400,140);c.closePath();c.fill();c.lineWidth=5;c.lineCap="round";c.strokeStyle="#b47925";c.beginPath();c.moveTo(15,80);c.lineTo(210,80);c.moveTo(15,170);c.lineTo(210,170);c.stroke();for(e=0;e<this.nb;e++){this.setnewpos(e);a=this.data[e].x;k=this.data[e].y;this.draw_barril(e,c,"#ff0000")}document.getElementById("nb_comp").value=this.nb_comp;document.getElementById("nb_dep").value=this.nb_move;if(this.mode_auto){this.etape(this);this.en_cours=false}},balance:function(){var a=this.pos[10],b=this.pos[11];if((a>=0)&&((this.data[a].x<300)||(this.data[a].x>400)||(this.data[a].y>100))){a=-1}if((b>=0)&&((this.data[b].x<400)||(this.data[b].x>600)||(this.data[b].y>100))){b=-1}this.balsens="=";if((a<0)&&(b<0)){this.balsens="="}else{if((a<0)&&(b>=0)){this.balsens=">";this.data[b].desty=45}else{if((a>=0)&&(b<0)){this.balsens="<";this.data[a].desty=45}else{if(this.data[a].valeur>this.data[b].valeur){this.balsens="<";this.data[a].desty=45;this.data[b].desty=25}else{if(this.data[a].valeur<this.data[b].valeur){this.balsens=">";this.data[a].desty=25;this.data[b].desty=45}else{this.balsens="=";this.data[a].desty=35;this.data[b].desty=35}}}}}},calcdest:function(d){var c=0,e=0;switch(this.data[d].position){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:this.data[d].destx=20+((this.data[d].position)*45);this.data[d].desty=200;break;case 10:this.data[d].destx=320;this.data[d].desty=25;c=this.pos[11];this.balance();break;case 11:this.data[d].destx=410;this.data[d].desty=25;c=this.pos[10];this.balance();break;case 12:case 13:case 14:case 15:case 16:e=this.data[d].position-12;this.data[d].destx=5+(e*43);this.data[d].desty=15;break;case 17:case 18:case 19:case 20:case 21:e=this.data[d].position-17;this.data[d].destx=5+(e*43);this.data[d].desty=105;break}},enddrag:function(d){var a=-1,c=0,b=false;for(c=0;c<22;c++){if(this.pos[c]>=0){if(!this.data[this.pos[c]].visible){this.pos[c]=-1}}}if(this.drag>=0){if((d.x>310)&&(d.x<390)&&(this.pos[10]==-1)&&(d.y<110)){a=this.data[this.drag].position;this.data[this.drag].position=10;this.pos[10]=this.drag;b=true;if(this.pos[11]!=-1){this.nb_comp++}}else{if((d.x>400)&&(d.x<480)&&(this.pos[11]==-1)&&(d.y<110)){a=this.data[this.drag].position;this.data[this.drag].position=11;this.pos[11]=this.drag;b=true;if(this.pos[10]!=-1){this.nb_comp++}}else{if(((d.y>150)||((d.x>190)&&(d.y>120)))&&(d.x>15)){c=Math.floor((d.x-20)/43);if((c>=0)&&(c<10)&&(this.pos[c]==-1)){a=this.data[this.drag].position;this.data[this.drag].position=c;this.pos[c]=this.drag;b=true;if(this.data[this.drag].index!=this.data[this.drag].position){this.nb_move++;this.data[this.drag].index=this.data[this.drag].position}}}else{if((d.y<55)&&(d.x>5)&&(d.x<300)){c=Math.floor((d.x-5)/43)+12;if((c>=12)&&(c<17)&&(this.pos[c]==-1)){a=this.data[this.drag].position;this.data[this.drag].position=c;this.pos[c]=this.drag;b=true}}}}}if((!b)&&(d.y<170)&&(d.x>5)&&(d.x<300)){c=Math.floor((d.x-5)/43)+17;if((c>=17)&&(c<22)&&(this.pos[c]==-1)){a=this.data[this.drag].position;this.data[this.drag].position=c;this.pos[c]=this.drag;b=true}}if(a>=0){this.pos[a]=-1;if((a==10)||(a==11)){this.balance()}}this.calcdest(this.drag);this.drag=-1;this.draw()}},etape:function(a){},init_auto:function(){this.mode_auto=true;this.en_cours=false;if(this.sel>""){$("#"+this.sel).selectmenu("option","disabled",true)}if(this.bt1>""){$("#"+this.bt1).button("option","disabled",true)}if(this.bt2>""){$("#"+this.bt2).button("option","disabled",true)}if(this.bt3>""){$("#"+this.bt3).button("option","label","Stop")}this.wait=0;var a=0;for(a=0;a<10;a++){if(this.data[a].visible){this.data[a].position=this.data[a].index;this.calcdest(a)}}this.phase=0;this.i=0;this.t=0;window.clearInterval(this.timer);this.nb_comp=0;this.nb_move=0;this.timer=window.setInterval("sort_game.draw()",10)},stop_auto:function(){this.mode_auto=false;this.en_cours=false;this.wait=0;this.phase=0;this.sol=false;window.clearInterval(this.timer);this.timer=window.setInterval("sort_game.draw()",50);this.balance();for(i=0;i<22;i++){this.pos[i]=-1}for(i=0;i<10;i++){if(this.data[i].visible){if(this.data[i].position>=0){this.pos[this.data[i].position]=i}}}if(this.sel>""){$("#"+this.sel).selectmenu("option","disabled",false)}if(this.bt1>""){$("#"+this.bt1).button("option","disabled",false)}if(this.bt2>""){$("#"+this.bt2).button("option","disabled",false)}if(this.bt3>""){$("#"+this.bt3).button("option","label","RÃ©soudre")}},mousemove:function(b){if(this.mode_auto){return}var c=this;var d=c.getmousepos(this.canvas,b);b=b||window.event;var a=b.which||b.button;if((1==a)&&(c.drag>=0)){c.data[c.drag].x=d.x-(10);c.data[c.drag].y=d.y-(32);c.data[c.drag].destx=c.data[c.drag].x;c.data[c.drag].desty=c.data[c.drag].y}c.draw()},mousedown:function(c){if(this.mode_auto){return}var d=this;var f=d.getmousepos(this.canvas,c);var a=0;var b={};for(a=0;a<10;a++){d.data[a].sel=false;b.x1=d.data[a].x;b.y1=d.data[a].y;b.x2=d.data[a].x+40;b.y2=d.data[a].y+65;if(d.pointinrectangle(f,b)){d.data[a].sel=true;d.drag=a}}d.draw()},mouseup:function(b){if(this.mode_auto){return}var c=this;var a=0;for(a=0;a<10;a++){c.data[a].sel=false}if(c.drag>=0){var d=c.getmousepos(this.canvas,b);c.enddrag(d)}c.draw()},mouseleave:function(a){if(this.mode_auto){return}var b=this.getmousepos(this.canvas,a);b.x=-1;b.y=-1;if(this.drag>=0){this.enddrag(b)}},getmousepos:function(d,b){var a=d.getBoundingClientRect();return{x:Math.round(b.clientX-a.left),y:Math.round(b.clientY-a.top)}},pointinrectangle:function(b,a){return b.x>a.x1&&b.x<a.x2&&b.y>a.y1&&b.y<a.y2}};